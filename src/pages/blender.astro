---
import MainLayout from '../layouts/MainLayout.astro';
import '../styles/blender.css';
---

<MainLayout title="3D Modeling Portfolio | Jonathan Sinaga">
  
  <section class="section portfolio-section" aria-labelledby="portfolio-title">
    <h2 id="portfolio-title" class="section__title">3D Modeling Portfolio</h2>
    <p class="section-description">
      Models and renders created using <strong>Blender</strong> and <strong>Cycles/Eevee</strong>
    </p>
    
    <div class="cards-container">
      
      <div class="card-wrapper" id="card-l300">
        <div class="card">
          <div class="card-content">
            <img src="/Imagery/projects/blender/l300/L300_Tampak_Depan_Kanan.webp" alt="3D Model of Mitsubishi L300 Pickup" class="main-image"/>
            <div class="text-content">
              <h1>Mitsubishi L300 - Automotive Modeling</h1>
              <p>
                A detailed 3D model of the legendary Mitsubishi L300 pickup.
                Focused on automotive hard surface techniques, accurate vehicle proportions, 
                and realistic shading using Blender.
              </p>
            </div>
          </div>
          <button class="toggle-button down" aria-expanded="false">&#x25BC; Detail</button>
        </div>
        
        <div class="additional-images hidden">
          <div class="transition-wrapper">
            <img src="/Imagery/projects/blender/l300/L300_Tampak_Belakang_Kanan.webp" class="img-normal" alt="Normal View"/>
            <img src="/Imagery/projects/blender/l300/L300_Tampak_Belakang_Kanan_Wireframe.webp" class="img-wireframe" alt="Wireframe View"/>
          </div>

          <div class="transition-wrapper">
            <img src="/Imagery/projects/blender/l300/L300_Tampak_Depan_Kanan.webp" class="img-normal" alt="Normal View"/>
            <img src="/Imagery/projects/blender/l300/L300_Tampak_Depan_Kanan_Wireframe.webp" class="img-wireframe" alt="Wireframe View"/>
          </div>

          <div class="transition-wrapper">
            <img src="/Imagery/projects/blender/l300/L300_Tampak_Samping_Kanan.webp" class="img-normal" alt="Normal View"/>
            <img src="/Imagery/projects/blender/l300/L300_Tampak_Samping_Kanan_Wireframe.webp" class="img-wireframe" alt="Wireframe View"/>
          </div>

          <button class="toggle-button up" aria-label="Sembunyikan detail">&#x25B2; Tutup</button>
        </div>
      </div>

      <div class="card-wrapper" id="card-sawit">
        <div class="card">
          <div class="card-content">
            <img src="/Imagery/projects/blender/sawit/Sawit_Tampak_Depan.webp" alt="3D Model Buah Sawit" class="main-image"/>
            <div class="text-content">
              <h1>Palm Fruit (Sawit) - Organic Modeling</h1>
              <p>
                Studi pemodelan organik detail dari Buah Kelapa Sawit. 
                Fokus pada pembentukan geometri alami buah, tekstur organik, 
                dan topologi yang rapi (quad-based topology).
              </p>
            </div>
          </div>
          <button class="toggle-button down" aria-expanded="false">&#x25BC; Detail</button>
        </div>
        
        <div class="additional-images hidden">

          <div class="transition-wrapper square">
            <img src="/Imagery/projects/blender/sawit/Sawit_Tampak_Depan_Kanan.webp" class="img-normal" alt="Sawit Kanan Normal"/>
            <img src="/Imagery/projects/blender/sawit/Sawit_Tampak_Depan_Kanan_Wireframe.webp" class="img-wireframe" alt="Sawit Kanan Wireframe"/>
          </div>

          <div class="transition-wrapper"> 
            <img src="/Imagery/projects/blender/sawit/Sawit_Tampak_Depan_Atas.webp" class="img-normal" alt="Sawit Atas Normal"/>
            <img src="/Imagery/projects/blender/sawit/Sawit_Tampak_Depan_Atas_Wireframe.webp" class="img-wireframe" alt="Sawit Atas Wireframe"/>
          </div>

          <div class="transition-wrapper square">
            <img src="/Imagery/projects/blender/sawit/Sawit_Tampak_Depan.webp" class="img-normal" alt="Sawit Depan Normal"/>
            <img src="/Imagery/projects/blender/sawit/Sawit_Tampak_Depan_Wireframe.webp" class="img-wireframe" alt="Sawit Depan Wireframe"/>
          </div>

          <button class="toggle-button up" aria-label="Sembunyikan detail">&#x25B2; Tutup</button>
        </div>
      </div>

    </div>
  </section>

</MainLayout>

<script>
  const animationIntervals = new Map();

  document.addEventListener('click', (event) => {
      // @ts-ignore
      const btn = event.target.closest('.toggle-button');
      if (!btn) return;

      const cardWrapper = btn.closest('.card-wrapper');
      if (!cardWrapper) return;
      
      const additionalImages = cardWrapper.querySelector('.additional-images');
      const downButton = cardWrapper.querySelector('.toggle-button.down');
      
      if (!additionalImages) return;

      // Logic: Open Detail
      if (btn.classList.contains('down')) {
          additionalImages.classList.remove('hidden');
          btn.classList.add('hidden');
          btn.setAttribute('aria-expanded', 'true');

          startAnimation(cardWrapper);
      } 
      
      // Logic: Close Detail
      else if (btn.classList.contains('up')) {
          additionalImages.classList.add('hidden');
          if (downButton) {
              downButton.classList.remove('hidden');
              downButton.setAttribute('aria-expanded', 'false');
          }

          stopAnimation(cardWrapper);
      }
  });

  function startAnimation(cardWrapper) {
    const wrappers = cardWrapper.querySelectorAll('.transition-wrapper');
    if (wrappers.length === 0) return;
    
    // Trigger sekali di awal supaya tidak menunggu 4 detik
    wrappers.forEach(wrapper => {
        wrapper.classList.toggle('show-wireframe');
      });

    // Loop: 3s hold + 1s transition (Total 4000ms)
    const intervalId = setInterval(() => {
      wrappers.forEach(wrapper => {
        wrapper.classList.toggle('show-wireframe');
      });
    }, 4000);

    animationIntervals.set(cardWrapper, intervalId);
  }

  function stopAnimation(cardWrapper) {
    if (animationIntervals.has(cardWrapper)) {
      clearInterval(animationIntervals.get(cardWrapper));
      animationIntervals.delete(cardWrapper);
    }

    // Reset to Normal view
    const wrappers = cardWrapper.querySelectorAll('.transition-wrapper');
    wrappers.forEach(wrapper => {
      wrapper.classList.remove('show-wireframe');
    });
  }
</script>